name: build

on:
  pull_request:
  push:
    branches:
      - master
jobs:
  coverage:
    name: Test and publish test coverage
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - uses: actions/setup-node@master
        with:
          node-version: '12'
      - run: npm install

      - uses: paambaati/codeclimate-action@v2.4.0
        env:
          CC_TEST_REPORTER_ID: ${{ secrets.CODE_CLIMATE_REPORTER_ID }}
          DB_HOST: ${{ secrets.DB_HOST }}
          DB_TESTNAME: ${{secrets.DB_TESTNAME}}
          DB_LOCALPASSWORD: ${{secrets.DB_LOCALPASSWORD}}
          DB_NAME: ${{secrets.DB_NAME}}
          DB_URL: ${{secrets.DB_URL}}
          DB_USER: ${{secrets.DB_USER}}
          JWT_PUBLIC: ${{secrets.JWT_PUBLIC}}
          JWT_SECRET: ${{secrets.JWT_SECRET}}
          DB_DATABASE_UR: ${{secrets.DB_DABABASE_URL}}
          NODE_ENV: test 
          DB_ENV: testing 
        with:
          coverageCommand: npm run coverage
          coverageLocations: "coverage/clover.xml:clover"
          debug: true
